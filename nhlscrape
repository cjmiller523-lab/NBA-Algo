import requests
from bs4 import BeautifulSoup
from datetime import datetime

def get_todays_games_html():
    today = datetime.now().strftime("%Y-%m-%d")
    url = f"https://www.nhl.com/scores/{today}"

    print(f"Scraping NHL.com for {today} ...")
    r = requests.get(url, headers={
        "User-Agent": "Mozilla/5.0"
    })

    if r.status_code != 200:
        print(f"❌ Failed to load NHL.com (status {r.status_code})")
        return []

    soup = BeautifulSoup(r.text, "html.parser")
    games = []

    # Each game is in a game-card container
    game_cards = soup.select("div.game-center--game")

    for card in game_cards:
        away = card.select_one("div.game-center--team-away span.team-meta--name")
        home = card.select_one("div.game-center--team-home span.team-meta--name")

        if not away or not home:
            continue

        away_name = away.text.strip()
        home_name = home.text.strip()

        # Convert full team names → abbreviations
        away_abbr = TEAM_NAME_TO_ABBR.get(away_name, away_name)
        home_abbr = TEAM_NAME_TO_ABBR.get(home_name, home_name)

        games.append((away_abbr, home_abbr))

    return games


# Mapping full NHL.com names → abbreviations
TEAM_NAME_TO_ABBR = {
    "Anaheim Ducks": "ANA",
    "Arizona Coyotes": "ARI",
    "Boston Bruins": "BOS",
    "Buffalo Sabres": "BUF",
    "Calgary Flames": "CGY",
    "Carolina Hurricanes": "CAR",
    "Chicago Blackhawks": "CHI",
    "Colorado Avalanche": "COL",
    "Columbus Blue Jackets": "CBJ",
    "Dallas Stars": "DAL",
    "Detroit Red Wings": "DET",
    "Edmonton Oilers": "EDM",
    "Florida Panthers": "FLA",
    "Los Angeles Kings": "LAK",
    "Minnesota Wild": "MIN",
    "Montreal Canadiens": "MTL",
    "Nashville Predators": "NSH",
    "New Jersey Devils": "NJD",
    "New York Islanders": "NYI",
    "New York Rangers": "NYR",
    "Ottawa Senators": "OTT",
    "Philadelphia Flyers": "PHI",
    "Pittsburgh Penguins": "PIT",
    "San Jose Sharks": "SJS",
    "Seattle Kraken": "SEA",
    "St. Louis Blues": "STL",
    "Tampa Bay Lightning": "TBL",
    "Toronto Maple Leafs": "TOR",
    "Utah Hockey Club": "UTA",
    "Vancouver Canucks": "VAN",
    "Vegas Golden Knights": "VGK",
    "Washington Capitals": "WSH",
    "Winnipeg Jets": "WPG",
}

if __name__ == "__main__":
    games = get_todays_games_html()

    if not games:
        print("No games found.")
    else:
        print("\nToday's Games:")
        for away, home in games:
            print(f"  {away} @ {home}")

        print(f"\nTotal: {len(games)} games")
